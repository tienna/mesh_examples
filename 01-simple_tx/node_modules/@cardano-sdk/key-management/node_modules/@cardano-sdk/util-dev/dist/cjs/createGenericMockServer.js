"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createGenericMockServer = void 0;
const http_1 = require("http");
const get_port_please_1 = require("get-port-please");
const createGenericMockServer = (listenerGenerator, serverPort) => (handler = async () => ({})) => new Promise(async (resolve, reject) => {
    try {
        const port = serverPort || (await (0, get_port_please_1.getRandomPort)());
        const server = (0, http_1.createServer)(listenerGenerator(handler));
        let resolver = jest.fn();
        let rejecter = jest.fn();
        const closePromise = new Promise((resolve, reject) => {
            resolver = resolve;
            rejecter = reject;
        });
        server.on('error', rejecter);
        server.listen(port, 'localhost', () => resolve({
            closeMock: () => {
                server.close((error) => (error ? rejecter(error) : resolver()));
                return closePromise;
            },
            serverUrl: `http://localhost:${port}`
        }));
    }
    catch (error) {
        reject(error);
    }
});
exports.createGenericMockServer = createGenericMockServer;
//# sourceMappingURL=createGenericMockServer.js.map